const e=e=>{const t=L.map("map",{zoomControl:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t);var s=L.icon({iconUrl:"/img/pin.png",iconSize:[32,40],iconAnchor:[16,40],popupAnchor:[0,-50]});const o=[];e.forEach((e=>{o.push([e.coordinates[1],e.coordinates[0]]),L.marker([e.coordinates[1],e.coordinates[0]],{icon:s}).addTo(t).bindPopup(`<p>Day ${e.day}: ${e.description}</p>`,{autoClose:!1,className:"mapPopup"}).openPopup()}));const a=L.latLngBounds(o).pad(.5);t.fitBounds(a),t.scrollWheelZoom.disable()},t=()=>{const e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},s=(e,s,o=5)=>{t();const a=`<div class="alert alert--${e}">${s}</div>`;document.querySelector("body").insertAdjacentHTML("afterbegin",a),window.setTimeout(t,1e3*o)},o=async(e,t)=>{try{"success"===(await axios({method:"POST",url:"/api/v1/users/login",data:{email:e,password:t}})).data.status&&(s("success","Logged in successfully!"),window.setTimeout((()=>{location.assign("/")}),1500))}catch(e){s("error",e.response.data.message)}},a=async(e,t)=>{try{const o="password"===t?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe";"success"===(await axios({method:"PATCH",url:o,data:e})).data.status&&s("success",`${t.toUpperCase()} setting successfully!`)}catch(e){console.log(e),s("error",e.response.data.message)}},n=(e,t,s,o)=>{let a;const n=new FileReader;return n.onload=e=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas"),d=e.getContext("2d");let r,c,i,u;e.width=t,e.height=s,n.height>n.width?(r=0,c=(n.height-n.width)/2,i=n.width,u=n.width*(s/t)):(r=(n.width-n.height)/2,c=0,i=n.height*(t/s),u=n.height),d.drawImage(n,r,c,i,u,0,0,t,s),a=e.toDataURL("image/jpeg"),o&&(o.src=a)},n.src=e.target.result},n.readAsDataURL(e),a},d=async(e,t,o,a)=>{try{"success"===(await axios({method:"POST",url:"/api/v1/users/signup",data:{name:e,email:t,password:o,passwordConfirm:a}})).data.status&&(s("success","Account created successfully!"),window.setTimeout((()=>{location.assign("/")}),1500))}catch(e){s("error",e.response.data.message)}},r=Stripe("pk_test_51Lg4wfIGwHIlOnnnUTzazEz6gRwdCEQwkogKTQSfQBHO6EB72NBzV5QChjmCS1CTANLcx7Pd1AApPFFWljgVxyKQ00K1ss2Wn9"),c=async e=>{try{const t=await axios(`/api/v1/bookings/checkout-session/${e}`);await r.redirectToCheckout({sessionId:t.data.session.id})}catch(e){console.log(e),s("error",e)}},i=document.getElementById("map"),u=document.getElementById("form--login"),l=document.querySelector(".nav__el--logout"),m=document.getElementById("form--update"),p=document.getElementById("form--password"),g=document.getElementById("photo"),y=document.getElementById("form--signup"),w=document.getElementById("book-tour");if(i){e(JSON.parse(i.dataset.locations))}u&&u.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("email").value,s=document.getElementById("password").value;o(t,s)})),l&&l.addEventListener("click",(async()=>{try{"success"===(await axios({method:"GET",url:"/api/v1/users/logout"})).data.status&&window.setTimeout((()=>{location.assign("/")}),1500)}catch(e){s("error","Error logging out! Try again.")}})),m&&(g.addEventListener("change",(async e=>{const t=g.files[0];if(t){const e=document.querySelector(".form__user-photo");n(t,500,500,e)}})),m.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData;t.append("name",document.getElementById("name").value),t.append("email",document.getElementById("email").value),t.append("photo",document.getElementById("photo").files[0]),await a(t,"data")}))),p&&p.addEventListener("submit",(async e=>{e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";const t=document.getElementById("password-current").value,s=document.getElementById("password").value,o=document.getElementById("password-confirm").value;await a({passwordCurrent:t,password:s,passwordConfirm:o},"password"),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""})),y&&y.addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("firstname").value+" "+document.getElementById("lastname").value,s=document.getElementById("email").value,o=document.getElementById("password").value,a=document.getElementById("password-confirm").value;d(t,s,o,a)})),w&&w.addEventListener("click",(e=>{e.target.textContent="Processing...";const{tourId:t}=e.target.dataset;c(t)}));const h=document.querySelector("body").dataset.alert;h&&s("success",h,7);
//# sourceMappingURL=index.js.map
